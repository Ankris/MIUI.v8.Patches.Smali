appfile <Settings.apk>;

# Add Onscreen Buttons setting
replaceinfile "%smali%/com/android/settings/KeySettings.smali"    	"instance fields" 																			"instance fields \n.field private mOnscreenButtons:Landroid/preference/CheckBoxPreference;\n";
replaceinmethod "%smali%/com/android/settings/KeySettings.smali" 	".method public onCreate(Landroid/os/Bundle;)V"		"invoke-interface {v0}, Landroid/view/IWindowManager;->hasNavigationBar()Z\n\n    move-result v0"		"const/4 v0, 0x1";
replaceinmethod "%smali%/com/android/settings/KeySettings.smali" 	".method public onCreate(Landroid/os/Bundle;)V"		"return-void"		"const-string v0, "onscreen_buttons"\n    invoke-virtual {p0, v0}, Lcom/android/settings/KeySettings;->findPreference(Ljava/lang/CharSequence;)Landroid/preference/Preference;\n    move-result-object v0\n    check-cast v0, Landroid/preference/CheckBoxPreference;\n    iput-object v0, p0, Lcom/android/settings/KeySettings;->mOnscreenButtons:Landroid/preference/CheckBoxPreference;\n    invoke-virtual {v0}, Landroid/preference/CheckBoxPreference;->isChecked()Z\n    move-result v0\n    const-string v1, "screen_button_custom"\n    invoke-virtual {p0, v1}, Lcom/android/settings/KeySettings;->findPreference(Ljava/lang/CharSequence;)Landroid/preference/Preference;\n    move-result-object v1\n    invoke-virtual {v1, v0}, Landroid/preference/PreferenceScreen;->setEnabled(Z)V \n    return-void";
replaceinmethod "%smali%/com/android/settings/KeySettings.smali" 	".method public onPreferenceTreeClick(Landroid/preference/PreferenceScreen;Landroid/preference/Preference;)Z" 	".prologue"					".prologue\n    iget-object v2, p0, Lcom/android/settings/KeySettings;->mOnscreenButtons:Landroid/preference/CheckBoxPreference;\n    if-ne p2, v2, :cond_30\n\n    const-string v0, "1"\n    const/4 v2, 0x0\n    const/4 v3, 0x1\n\n    iget-object v2, p0, Lcom/android/settings/KeySettings;->mOnscreenButtons:Landroid/preference/CheckBoxPreference;\n    invoke-virtual {v2}, Landroid/preference/CheckBoxPreference;->isChecked()Z\n    move-result v2\n    if-eqz v2, :cond_25\n    const/4 v3, 0x0\n    const-string v0, "0"\n    :cond_25\n\n    const-string v1, "persist.sys.mainkeys"\n    invoke-static {v1, v0}, Landroid/os/SystemProperties;->set(Ljava/lang/String;Ljava/lang/String;)V\n    const-string v1, "screen_button_custom"\n    invoke-virtual {p0, v1}, Lcom/android/settings/KeySettings;->findPreference(Ljava/lang/CharSequence;)Landroid/preference/Preference;\n    move-result-object v1\n    if-eqz v1, :cond_26\n    invoke-virtual {v1, v2}, Landroid/preference/PreferenceScreen;->setEnabled(Z)V \n    :cond_26\n\n    const-string v2, "screen_buttons_turn_on"\n    invoke-virtual {p0}, Lcom/android/settings/KeySettings;->getContentResolver()Landroid/content/ContentResolver;\n    move-result-object v1\n    invoke-static {v1, v2, v3}, Landroid/provider/Settings$Secure;->putInt(Landroid/content/ContentResolver;Ljava/lang/String;I)Z\n\n    const-string v1, "pref_button_light"\n    invoke-virtual {p0, v1}, Lcom/android/settings/KeySettings;->findPreference(Ljava/lang/CharSequence;)Landroid/preference/Preference;\n    move-result-object v2\n    if-eqz v2, :cond_27\n    invoke-virtual {v2, v3}, Landroid/preference/PreferenceScreen;->setEnabled(Z)V \n    check-cast v2, Landroid/preference/CheckBoxPreference;\n    invoke-virtual {v2, v3}, Landroid/preference/CheckBoxPreference;->setChecked(Z)V\n    :cond_27\n\n    const-string v1, "button_light_timeout"\n    invoke-virtual {p0, v1}, Lcom/android/settings/KeySettings;->findPreference(Ljava/lang/CharSequence;)Landroid/preference/Preference;\n    move-result-object v1\n    if-eqz v1, :cond_28\n    invoke-virtual {v1, v3}, Landroid/preference/PreferenceScreen;->setEnabled(Z)V \n    :cond_28\n\n    invoke-super {p0, p1, p2}, Lcom/android/settings/SettingsPreferenceFragment;->onPreferenceTreeClick(Landroid/preference/PreferenceScreen;Landroid/preference/Preference;)Z\n    move-result v0\n    return v0\n    :cond_30";
replaceinfile 	"%res%/xml/key_settings.xml"    			"<Preference android:title="@string/status_bar_key_position_custom" 											"<CheckBoxPreference android:title="@string/status_bar_screen_button_key" android:summary="@string/whetstone_level_reboot" android:key="onscreen_buttons" /> \n        <Preference android:title="@string/key_settings";
copy 		"%here%/system" 					"%res%/../../../../baseROM/system";
