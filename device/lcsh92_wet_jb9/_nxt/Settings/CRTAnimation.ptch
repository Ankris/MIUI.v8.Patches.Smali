appfile <Settings.apk>;

# Add CRT animation setting
replaceinfile "%smali%/com/android/settings/MiuiSecuritySettings.smali"    		"instance fields"												"instance fields \n\n .field private mCrtLockscreen:Landroid/preference/CheckBoxPreference;";
replaceinmethod "%smali%/com/android/settings/MiuiSecuritySettings.smali" 		".method public onResume()V" 											"return-void"		"const-string v0, "allow_crt_lockscreen"\n\n    invoke-virtual {p0, v0}, Lcom/android/settings/MiuiSecuritySettings;->findPreference(Ljava/lang/CharSequence;)Landroid/preference/Preference;\n\n    move-result-object v0\n\n    check-cast v0, Landroid/preference/CheckBoxPreference;\n\n    iput-object v0, p0, Lcom/android/settings/MiuiSecuritySettings;->mCrtLockscreen:Landroid/preference/CheckBoxPreference;\n\n    return-void";
replaceinmethod "%smali%/com/android/settings/MiuiSecuritySettings.smali" 		".method public onPreferenceTreeClick(Landroid/preference/PreferenceScreen;Landroid/preference/Preference;)Z"	".prologue" 	".prologue\n    iget-object v2, p0, Lcom/android/settings/MiuiSecuritySettings;->mCrtLockscreen:Landroid/preference/CheckBoxPreference;\n    if-ne p2, v2, :crt_end\n    const-string v0, "true"\n    invoke-virtual {v2}, Landroid/preference/CheckBoxPreference;->isChecked()Z\n    move-result v2\n    if-nez v2, :crt_true\n    const-string v0, "false"\n    :crt_true\n    const-string v3, "persist.sys.crt.animation"\n    invoke-static {v3, v0}, Landroid/os/SystemProperties;->set(Ljava/lang/String;Ljava/lang/String;)V\n    invoke-super {p0, p1, p2}, Lcom/android/settings/KeyguardSettingsPreferenceFragment;->onPreferenceTreeClick(Landroid/preference/PreferenceScreen;Landroid/preference/Preference;)Z\n    move-result v0\n    return v0\n    :crt_end";
replaceinfile "%res%/xml/security_settings_common.xml"    				"<CheckBoxPreference android:persistent="false" android:title="@string/lockpattern_settings" 			"<CheckBoxPreference android:title="@string/crt_animation" android:key="allow_crt_lockscreen" android:summary="@string/crt_summary" />\n       <CheckBoxPreference android:persistent="false" android:title="@string/lockpattern_settings";
# Do not forget to add XML string patches
