appfile <Services.jar>;

# Fix mounting
copyfile "%here%/Services.jar/MountService.smali" "%smali%/com/android/server/MountService.smali";

# Lower autobrightness delay time
replaceinfile "%smali%/com/miui/server/power/DisplayPowerController.smali" "BRIGHTENING_LIGHT_DEBOUNCE:J = 0xfa0L" "BRIGHTENING_LIGHT_DEBOUNCE:J = 0x7d0L";
replaceinfile "%smali%/com/miui/server/power/DisplayPowerController.smali" "DARKENING_LIGHT_DEBOUNCE:J = 0xfa0L" "DARKENING_LIGHT_DEBOUNCE:J = 0x7d0L";
replaceinfile "%smali%/com/miui/server/power/DisplayPowerController.smali" "const-wide/16 v11, 0xfa0" "const-wide/16 v11, 0x7d0";
replaceinfile "%smali%/com/miui/server/power/DisplayPowerController.smali" "waiting for 4000 ms" "waiting for 2000 ms";

############################ Smooth autobrightness animation #################################
# BRIGHTNESS_RAMP_RATE_SLOW
#replaceinfile "%smali%/com/miui/server/power/DisplayPowerController.smali" "0x28" "0x50";
# BRIGHTNESS_RAMP_RATE_SLOW
#replaceinfile "%smali%/com/miui/server/power/DisplayPowerController.smali" "const/16 v6, 0xc8" "const/16 v6, 0x12c";
# LONG_TERM_AVERAGE_LIGHT_TIME_CONSTANT
replaceinfile "%smali%/com/miui/server/power/DisplayPowerController.smali" "0x1f4" "0xfa";
# SHORT_TERM_AVERAGE_LIGHT_TIME_CONSTANT
replaceinfile "%smali%/com/miui/server/power/DisplayPowerController.smali" "const-wide/16 v4, 0x64" "const-wide/16 v4, 0x32";
# SCREEN_DIM_MINIMUM_REDUCTION
replaceinfile "%smali%/com/miui/server/power/DisplayPowerController.smali" "add-int/lit8 v6, v3, -0xa" "add-int/lit8 v6, v3, -0x1";

# Smart Wake
methodreplace "%smali%/com/android/server/power/PowerManagerService.smali" ".method private static wakefulnessToString(I)Ljava/lang/String;" "%here%/Services.jar/wakefulnessToString.m";
methodreplace "%smali%/com/android/server/power/PowerManagerService.smali" ".method static synthetic access$3000(Lcom/android/server/power/PowerManagerService;)V" "%here%/Services.jar/3000.m";
methodreplace "%smali%/com/android/server/power/PowerManagerService$BootCompletedReceiver.smali" ".method public onReceive(Landroid/content/Context;Landroid/content/Intent;)V" "%here%/Services.jar/onReceive.m";

#Enable CRT animation on parameter persist.sys.crt.animation=true
replaceinfile "%smali%/com/android/server/power/DisplayPowerController.smali" 		"const-wide/16 v1, 0x0" "const-wide/16 v1, 0x190";
replaceinfile "%smali%/com/android/server/power/DisplayPowerController.smali" 		".field private static final ELECTRON_BEAM_OFF_ANIMATION_DURATION_MILLIS:I = 0x0" 		".field private static final ELECTRON_BEAM_OFF_ANIMATION_DURATION_MILLIS:I = 0x190";
replaceinfile "%smali%/com/android/server/power/DisplayPowerController.smali" 		"    :cond_27" 																			"    :cond_27\n    iget-object v6, p0, Lcom/android/server/power/DisplayPowerController;->mPowerState:Lcom/android/server/power/DisplayPowerState;";
replaceinfile "%smali%/com/android/server/power/DisplayPowerController.smali" 		"iget-object v6, p0, Lcom/android/server/power/DisplayPowerController;->mPowerState:Lcom/android/server/power/DisplayPowerState;\n\n    iget-boolean v8, p0, Lcom/android/server/power/DisplayPowerController;->mElectronBeamFadesConfig:Z\n\n    if-eqz v8, :cond_27" 		"const-string v8, "persist.sys.crt.animation"\n\n    const/4 v7, 0x0\n\n    const/4 v10, 0x0\n\n    invoke-static {v8, v10}, Landroid/os/SystemProperties;->getBoolean(Ljava/lang/String;Z)Z\n\n    move-result v8\n\n    if-nez v8, :cond_27";

# Default installation to internal mamory #############
methodreplace "%smali%/com/android/server/pm/PackageManagerService.smali" ".method private static installOnSd(I)Z" "%here%/Services.jar/installOnSd.m";
